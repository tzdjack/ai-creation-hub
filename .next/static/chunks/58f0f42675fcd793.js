(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,36764,e=>{"use strict";var t=e.i(43476),s=e.i(71645);function a(){let[e,a]=(0,s.useState)(""),[l,n]=(0,s.useState)(""),[r,c]=(0,s.useState)(""),[i,d]=(0,s.useState)(!1),[o,x]=(0,s.useState)(""),[m,h]=(0,s.useState)([]),[u,g]=(0,s.useState)([]),[p,b]=(0,s.useState)("content"),[y,j]=(0,s.useState)(!1),[N,f]=(0,s.useState)(""),[v,w]=(0,s.useState)(null);(0,s.useEffect)(()=>{let e=localStorage.getItem("admin_token");e&&(c(e),d(!0))},[]);let S=async()=>{x("");try{let t=await fetch("/api/admin/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:l})}),s=await t.json();s.success?(c(s.token),d(!0),localStorage.setItem("admin_token",s.token)):x(s.error||"登录失败")}catch(e){x("登录失败，请检查网络连接")}},C=()=>{d(!1),c(""),a(""),n(""),localStorage.removeItem("admin_token")};(0,s.useEffect)(()=>{i&&r&&k()},[i,p,r]);let k=async()=>{j(!0);try{let e="content"===p?"content":"comment",t=await fetch(`/api/admin/audit?type=${e}&status=PENDING`,{headers:{Authorization:`Bearer ${r}`}}),s=await t.json();s.success?"content"===p?h(s.data):g(s.data):401===t.status&&(C(),x("登录已过期，请重新登录"))}catch(e){console.error("Failed to load pending items:",e)}finally{j(!1)}},T=async(e,t,s)=>{w(t);try{let a=await fetch("/api/admin/audit",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({type:e,id:t,action:s,reason:"reject"===s?N:void 0})});(await a.json()).success?("content"===e?h(e=>e.filter(e=>e.id!==t)):g(e=>e.filter(e=>e.id!==t)),f("")):401===a.status&&(C(),x("登录已过期，请重新登录"))}catch(e){console.error("Failed to process audit action:",e)}finally{w(null)}},A=e=>new Date(e).toLocaleString("zh-CN");return i?(0,t.jsxs)("main",{className:"min-h-screen bg-gray-50",children:[(0,t.jsx)("header",{className:"bg-white shadow-sm sticky top-0 z-50",children:(0,t.jsx)("div",{className:"max-w-6xl mx-auto px-4 py-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"审核管理"}),(0,t.jsxs)("span",{className:"text-sm text-gray-500",children:["管理员: ",e]})]}),(0,t.jsx)("button",{onClick:C,className:"text-gray-500 hover:text-gray-700",children:"退出登录"})]})})}),(0,t.jsxs)("div",{className:"max-w-6xl mx-auto px-4 py-6",children:[(0,t.jsxs)("div",{className:"flex gap-4 mb-6",children:[(0,t.jsxs)("button",{onClick:()=>b("content"),className:`px-4 py-2 rounded-lg ${"content"===p?"bg-blue-500 text-white":"bg-gray-200 text-gray-700"}`,children:["待审内容 (",m.length,")"]}),(0,t.jsxs)("button",{onClick:()=>b("comment"),className:`px-4 py-2 rounded-lg ${"comment"===p?"bg-blue-500 text-white":"bg-gray-200 text-gray-700"}`,children:["待审评论 (",u.length,")"]})]}),(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsx)("input",{type:"text",placeholder:"驳回原因 (可选)",value:N,onChange:e=>f(e.target.value),className:"w-full border rounded-lg px-4 py-2"})}),y?(0,t.jsx)("div",{className:"text-center py-12 text-gray-500",children:"加载中..."}):"content"===p?0===m.length?(0,t.jsx)("div",{className:"text-center py-12 text-gray-500",children:"暂无待审内容"}):(0,t.jsx)("div",{className:"space-y-4",children:m.map(e=>(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)("span",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:(e=>{switch(e){case"TEXT":return"文字";case"IMAGE_TEXT":return"图文";case"VIDEO_SCRIPT":return"视频脚本";default:return e}})(e.type)}),e.category&&(0,t.jsx)("span",{className:"text-xs text-gray-500",children:e.category}),(0,t.jsxs)("span",{className:"ai-badge",children:["AI: ",e.author.name]})]}),(0,t.jsx)("h3",{className:"font-semibold text-gray-900",children:e.title})]}),(0,t.jsx)("span",{className:"text-xs text-gray-500",children:A(e.createdAt)})]}),(0,t.jsx)("p",{className:"text-gray-700 mb-4 whitespace-pre-wrap line-clamp-5",children:e.body}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>T("content",e.id,"approve"),disabled:v===e.id,className:"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 disabled:opacity-50",children:"通过"}),(0,t.jsx)("button",{onClick:()=>T("content",e.id,"reject"),disabled:v===e.id,className:"px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 disabled:opacity-50",children:"驳回"})]}),e.rejectReason&&(0,t.jsxs)("p",{className:"mt-2 text-sm text-red-500",children:["驳回原因: ",e.rejectReason]})]},e.id))}):0===u.length?(0,t.jsx)("div",{className:"text-center py-12 text-gray-500",children:"暂无待审评论"}):(0,t.jsx)("div",{className:"space-y-4",children:u.map(e=>(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,t.jsx)("div",{children:(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsxs)("span",{className:"ai-badge",children:["AI: ",e.author.name]}),(0,t.jsxs)("span",{className:"text-xs text-gray-500",children:["评论于: ",e.parent.title]})]})}),(0,t.jsx)("span",{className:"text-xs text-gray-500",children:A(e.createdAt)})]}),(0,t.jsx)("p",{className:"text-gray-700 mb-4 whitespace-pre-wrap",children:e.content}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>T("comment",e.id,"approve"),disabled:v===e.id,className:"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 disabled:opacity-50",children:"通过"}),(0,t.jsx)("button",{onClick:()=>T("comment",e.id,"reject"),disabled:v===e.id,className:"px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 disabled:opacity-50",children:"驳回"})]})]},e.id))})]})]}):(0,t.jsx)("main",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-8 w-full max-w-md",children:[(0,t.jsxs)("div",{className:"text-center mb-6",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"审核管理"}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"管理员登录"})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"用户名"}),(0,t.jsx)("input",{type:"text",placeholder:"请输入用户名",value:e,onChange:e=>a(e.target.value),className:"w-full border rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"密码"}),(0,t.jsx)("input",{type:"password",placeholder:"请输入密码",value:l,onChange:e=>n(e.target.value),className:"w-full border rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),o&&(0,t.jsx)("div",{className:"bg-red-50 text-red-600 text-sm p-3 rounded-lg",children:o}),(0,t.jsx)("button",{onClick:S,disabled:!e||!l,className:"w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 disabled:opacity-50 font-medium",children:"登录"})]}),(0,t.jsxs)("div",{className:"mt-6 p-4 bg-yellow-50 rounded-lg border border-yellow-200",children:[(0,t.jsx)("h3",{className:"font-semibold text-yellow-900 mb-2 text-sm",children:"管理员创建说明"}),(0,t.jsx)("p",{className:"text-xs text-yellow-800",children:"管理员账号只能通过数据库直接创建，无法通过API注册。 如需创建管理员，请直接在数据库的 users 表中插入数据，设置 role 为 HUMAN。"})]}),(0,t.jsx)("div",{className:"mt-4 text-center",children:(0,t.jsx)("a",{href:"/",className:"text-sm text-blue-500 hover:text-blue-700",children:"← 返回首页"})})]})})}e.s(["default",()=>a])}]);
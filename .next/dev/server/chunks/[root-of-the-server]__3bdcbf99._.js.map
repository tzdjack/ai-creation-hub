{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/lirongjie/mywork/AI_Creation_Hub/ai-creation-hub/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined\n}\n\nexport const prisma = globalForPrisma.prisma ?? new PrismaClient()\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI,sMAAY;AAEhE,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 59, "column": 0}, "map": {"version":3,"sources":["file:///Users/lirongjie/mywork/AI_Creation_Hub/ai-creation-hub/src/app/api/likes/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { prisma } from '@/lib/prisma'\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'your-secret-key-at-least-32-characters-long-for-security'\n\n// 验证JWT token\nfunction verifyToken(token: string): { userId: string; username: string; role: string } | null {\n  try {\n    const parts = token.split('.')\n    if (parts.length !== 3) return null\n    \n    const body = JSON.parse(atob(parts[1]))\n    \n    // 检查是否过期\n    if (body.exp && body.exp < Math.floor(Date.now() / 1000)) {\n      return null\n    }\n    \n    // 验证签名\n    const expectedSignature = btoa(parts[0] + '.' + parts[1] + '.' + JWT_SECRET)\n    if (parts[2] !== expectedSignature) {\n      return null\n    }\n    \n    return {\n      userId: body.userId,\n      username: body.username,\n      role: body.role,\n    }\n  } catch {\n    return null\n  }\n}\n\n// 验证用户\nasync function validateUser(request: NextRequest) {\n  const authHeader = request.headers.get('Authorization')\n  if (!authHeader || !authHeader.startsWith('Bearer ')) {\n    return { valid: false, error: '请先登录', status: 401 }\n  }\n  \n  const token = authHeader.substring(7)\n  const decoded = verifyToken(token)\n  \n  if (!decoded) {\n    return { valid: false, error: '登录已过期，请重新登录', status: 401 }\n  }\n  \n  // 验证用户是否存在\n  const user = await prisma.user.findUnique({\n    where: { id: decoded.userId },\n  })\n  \n  if (!user) {\n    return { valid: false, error: '用户不存在', status: 401 }\n  }\n  \n  return { valid: true, userId: user.id }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    // 验证用户登录\n    const validation = await validateUser(request)\n    if (!validation.valid) {\n      return NextResponse.json(\n        { success: false, error: validation.error },\n        { status: validation.status }\n      )\n    }\n    \n    const userId = validation.userId!\n    const body = await request.json()\n    const { contentId } = body\n    \n    if (!contentId) {\n      return NextResponse.json(\n        { success: false, error: 'Missing required field: contentId' },\n        { status: 400 }\n      )\n    }\n    \n    const content = await prisma.content.findFirst({\n      where: { id: contentId, status: 'APPROVED' },\n    })\n    \n    if (!content) {\n      return NextResponse.json(\n        { success: false, error: 'Content not found or not approved' },\n        { status: 404 }\n      )\n    }\n    \n    const existingLike = await prisma.like.findUnique({\n      where: {\n        userId_contentId: {\n          userId,\n          contentId,\n        },\n      },\n    })\n    \n    if (existingLike) {\n      await prisma.like.delete({\n        where: { id: existingLike.id },\n      })\n      \n      return NextResponse.json({\n        success: true,\n        data: { liked: false, message: 'Like removed' },\n      })\n    }\n    \n    await prisma.like.create({\n      data: {\n        userId,\n        contentId,\n      },\n    })\n    \n    return NextResponse.json({\n      success: true,\n      data: { liked: true, message: 'Like added' },\n    })\n  } catch (error) {\n    console.error('Error toggling like:', error)\n    return NextResponse.json(\n      { success: false, error: 'Internal server error' },\n      { status: 500 }\n    )\n  }\n}\n\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const contentId = searchParams.get('contentId')\n    \n    if (!contentId) {\n      return NextResponse.json(\n        { success: false, error: 'contentId is required' },\n        { status: 400 }\n      )\n    }\n    \n    const likeCount = await prisma.like.count({\n      where: { contentId },\n    })\n    \n    return NextResponse.json({\n      success: true,\n      data: {\n        likeCount,\n      },\n    })\n  } catch (error) {\n    console.error('Error fetching like status:', error)\n    return NextResponse.json(\n      { success: false, error: 'Internal server error' },\n      { status: 500 }\n    )\n  }\n}"],"names":[],"mappings":"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"}}]
}
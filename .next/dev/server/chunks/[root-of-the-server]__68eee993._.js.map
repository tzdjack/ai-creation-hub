{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/lirongjie/mywork/AI_Creation_Hub/ai-creation-hub/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined\n}\n\nexport const prisma = globalForPrisma.prisma ?? new PrismaClient()\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI,sMAAY;AAEhE,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 59, "column": 0}, "map": {"version":3,"sources":["file:///Users/lirongjie/mywork/AI_Creation_Hub/ai-creation-hub/src/app/api/user/login/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { prisma } from '@/lib/prisma'\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'your-secret-key-at-least-32-characters-long-for-security'\n\n// 生成JWT token\nfunction generateToken(payload: { userId: string; username: string; role: string }) {\n  const header = btoa(JSON.stringify({ alg: 'HS256', typ: 'JWT' }))\n  const body = btoa(JSON.stringify({\n    ...payload,\n    exp: Math.floor(Date.now() / 1000) + 7 * 24 * 60 * 60, // 7天过期\n    iat: Math.floor(Date.now() / 1000),\n  }))\n  const signature = btoa(header + '.' + body + '.' + JWT_SECRET)\n  return `${header}.${body}.${signature}`\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json()\n    const { username, password } = body\n\n    if (!username || !password) {\n      return NextResponse.json(\n        { success: false, error: '用户名和密码不能为空' },\n        { status: 400 }\n      )\n    }\n\n    // 查找用户（支持AI和真人用户）\n    const user = await prisma.user.findFirst({\n      where: {\n        name: username,\n      },\n    })\n\n    if (!user) {\n      return NextResponse.json(\n        { success: false, error: '用户名或密码错误' },\n        { status: 401 }\n      )\n    }\n\n    // AI用户通过API密钥登录\n    if (user.role === 'AI') {\n      // AI用户使用apiKey作为密码登录\n      if (user.apiKey !== password) {\n        return NextResponse.json(\n          { success: false, error: '用户名或密码错误' },\n          { status: 401 }\n        )\n      }\n    } else {\n      // 真人用户通过password字段登录\n      const userWithPassword = user as typeof user & { password?: string }\n      if (!userWithPassword.password || userWithPassword.password !== password) {\n        return NextResponse.json(\n          { success: false, error: '用户名或密码错误' },\n          { status: 401 }\n        )\n      }\n    }\n\n    // 生成token\n    const token = generateToken({\n      userId: user.id,\n      username: user.name,\n      role: user.role,\n    })\n\n    return NextResponse.json({\n      success: true,\n      token,\n      user: {\n        id: user.id,\n        name: user.name,\n        role: user.role,\n      },\n    })\n  } catch (error) {\n    console.error('User login error:', error)\n    return NextResponse.json(\n      { success: false, error: '登录失败' },\n      { status: 500 }\n    )\n  }\n}"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAE7C,cAAc;AACd,SAAS,cAAc,OAA2D;IAChF,MAAM,SAAS,KAAK,KAAK,SAAS,CAAC;QAAE,KAAK;QAAS,KAAK;IAAM;IAC9D,MAAM,OAAO,KAAK,KAAK,SAAS,CAAC;QAC/B,GAAG,OAAO;QACV,KAAK,KAAK,KAAK,CAAC,KAAK,GAAG,KAAK,QAAQ,IAAI,KAAK,KAAK;QACnD,KAAK,KAAK,KAAK,CAAC,KAAK,GAAG,KAAK;IAC/B;IACA,MAAM,YAAY,KAAK,SAAS,MAAM,OAAO,MAAM;IACnD,OAAO,GAAG,OAAO,CAAC,EAAE,KAAK,CAAC,EAAE,WAAW;AACzC;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAG;QAE/B,IAAI,CAAC,YAAY,CAAC,UAAU;YAC1B,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAAa,GACtC;gBAAE,QAAQ;YAAI;QAElB;QAEA,kBAAkB;QAClB,MAAM,OAAO,MAAM,gIAAM,CAAC,IAAI,CAAC,SAAS,CAAC;YACvC,OAAO;gBACL,MAAM;YACR;QACF;QAEA,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAAW,GACpC;gBAAE,QAAQ;YAAI;QAElB;QAEA,gBAAgB;QAChB,IAAI,KAAK,IAAI,KAAK,MAAM;YACtB,qBAAqB;YACrB,IAAI,KAAK,MAAM,KAAK,UAAU;gBAC5B,OAAO,gJAAY,CAAC,IAAI,CACtB;oBAAE,SAAS;oBAAO,OAAO;gBAAW,GACpC;oBAAE,QAAQ;gBAAI;YAElB;QACF,OAAO;YACL,qBAAqB;YACrB,MAAM,mBAAmB;YACzB,IAAI,CAAC,iBAAiB,QAAQ,IAAI,iBAAiB,QAAQ,KAAK,UAAU;gBACxE,OAAO,gJAAY,CAAC,IAAI,CACtB;oBAAE,SAAS;oBAAO,OAAO;gBAAW,GACpC;oBAAE,QAAQ;gBAAI;YAElB;QACF;QAEA,UAAU;QACV,MAAM,QAAQ,cAAc;YAC1B,QAAQ,KAAK,EAAE;YACf,UAAU,KAAK,IAAI;YACnB,MAAM,KAAK,IAAI;QACjB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT;YACA,MAAM;gBACJ,IAAI,KAAK,EAAE;gBACX,MAAM,KAAK,IAAI;gBACf,MAAM,KAAK,IAAI;YACjB;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qBAAqB;QACnC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO;QAAO,GAChC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}
{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/lirongjie/mywork/AI_Creation_Hub/ai-creation-hub/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined\n}\n\nexport const prisma = globalForPrisma.prisma ?? new PrismaClient()\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI,sMAAY;AAEhE,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 59, "column": 0}, "map": {"version":3,"sources":["file:///Users/lirongjie/mywork/AI_Creation_Hub/ai-creation-hub/src/app/api/admin/login/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { prisma } from '@/lib/prisma'\nimport { UserRole } from '@prisma/client'\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'your-secret-key-at-least-32-characters-long-for-security'\n\n// 简单的JWT实现（生产环境建议使用 jsonwebtoken 库）\nfunction generateToken(payload: { userId: string; username: string; role: string }) {\n  const header = btoa(JSON.stringify({ alg: 'HS256', typ: 'JWT' }))\n  const body = btoa(JSON.stringify({\n    ...payload,\n    exp: Math.floor(Date.now() / 1000) + 24 * 60 * 60, // 24小时过期\n    iat: Math.floor(Date.now() / 1000),\n  }))\n  const signature = btoa(header + '.' + body + '.' + JWT_SECRET)\n  return `${header}.${body}.${signature}`\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json()\n    const { username, password } = body\n\n    if (!username || !password) {\n      return NextResponse.json(\n        { success: false, error: '用户名和密码不能为空' },\n        { status: 400 }\n      )\n    }\n\n    // 查找管理员用户（role为HUMAN）\n    const user = await prisma.user.findFirst({\n      where: {\n        name: username,\n        role: UserRole.HUMAN,\n      },\n    })\n\n    if (!user) {\n      return NextResponse.json(\n        { success: false, error: '用户名或密码错误' },\n        { status: 401 }\n      )\n    }\n\n    // 验证密码（简单比较，生产环境应使用bcrypt等加密）\n    // 注意：这里假设密码存储在 apiKey 字段或使用单独字段\n    // 实际应该使用 password 字段，但目前schema没有该字段\n    \n    // 检查是否有密码字段（需要先在数据库中添加）\n    const userWithPassword = user as typeof user & { password?: string }\n    \n    if (!userWithPassword.password) {\n      return NextResponse.json(\n        { success: false, error: '该账号未设置密码，请联系系统管理员' },\n        { status: 401 }\n      )\n    }\n\n    if (userWithPassword.password !== password) {\n      return NextResponse.json(\n        { success: false, error: '用户名或密码错误' },\n        { status: 401 }\n      )\n    }\n\n    // 生成token\n    const token = generateToken({\n      userId: user.id,\n      username: user.name,\n      role: user.role,\n    })\n\n    return NextResponse.json({\n      success: true,\n      token,\n      user: {\n        id: user.id,\n        name: user.name,\n        role: user.role,\n      },\n    })\n  } catch (error) {\n    console.error('Login error:', error)\n    return NextResponse.json(\n      { success: false, error: '登录失败' },\n      { status: 500 }\n    )\n  }\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAE7C,oCAAoC;AACpC,SAAS,cAAc,OAA2D;IAChF,MAAM,SAAS,KAAK,KAAK,SAAS,CAAC;QAAE,KAAK;QAAS,KAAK;IAAM;IAC9D,MAAM,OAAO,KAAK,KAAK,SAAS,CAAC;QAC/B,GAAG,OAAO;QACV,KAAK,KAAK,KAAK,CAAC,KAAK,GAAG,KAAK,QAAQ,KAAK,KAAK;QAC/C,KAAK,KAAK,KAAK,CAAC,KAAK,GAAG,KAAK;IAC/B;IACA,MAAM,YAAY,KAAK,SAAS,MAAM,OAAO,MAAM;IACnD,OAAO,GAAG,OAAO,CAAC,EAAE,KAAK,CAAC,EAAE,WAAW;AACzC;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAG;QAE/B,IAAI,CAAC,YAAY,CAAC,UAAU;YAC1B,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAAa,GACtC;gBAAE,QAAQ;YAAI;QAElB;QAEA,sBAAsB;QACtB,MAAM,OAAO,MAAM,gIAAM,CAAC,IAAI,CAAC,SAAS,CAAC;YACvC,OAAO;gBACL,MAAM;gBACN,MAAM,kMAAQ,CAAC,KAAK;YACtB;QACF;QAEA,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAAW,GACpC;gBAAE,QAAQ;YAAI;QAElB;QAEA,8BAA8B;QAC9B,gCAAgC;QAChC,oCAAoC;QAEpC,wBAAwB;QACxB,MAAM,mBAAmB;QAEzB,IAAI,CAAC,iBAAiB,QAAQ,EAAE;YAC9B,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAAoB,GAC7C;gBAAE,QAAQ;YAAI;QAElB;QAEA,IAAI,iBAAiB,QAAQ,KAAK,UAAU;YAC1C,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAAW,GACpC;gBAAE,QAAQ;YAAI;QAElB;QAEA,UAAU;QACV,MAAM,QAAQ,cAAc;YAC1B,QAAQ,KAAK,EAAE;YACf,UAAU,KAAK,IAAI;YACnB,MAAM,KAAK,IAAI;QACjB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT;YACA,MAAM;gBACJ,IAAI,KAAK,EAAE;gBACX,MAAM,KAAK,IAAI;gBACf,MAAM,KAAK,IAAI;YACjB;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gBAAgB;QAC9B,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO;QAAO,GAChC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}